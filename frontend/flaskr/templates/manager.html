{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/manager.css') }}">
{% endblock %}

{% block content %}
<div class="manager-container">
    <div class="manager-header">
        <h1>
            <i class="fas fa-cogs"></i>
            Store Management Dashboard
        </h1>
        <p>Manage your rental inventory and monitor business performance</p>
    </div>

    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-icon items">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-number">{{ template_items|length }}</div>
            <div class="stat-label">Total Items</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon rented">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="stat-number">
                {% set rented_count = 0 %}
                {% for item in template_items %}
                    {% set rented_count = rented_count + (template_items[item].stock_size - template_items[item].available) %}
                {% endfor %}
                {{ rented_count }}
            </div>
            <div class="stat-label">Currently Rented</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon available">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-number">
                {% set available_count = 0 %}
                {% for item in template_items %}
                    {% set available_count = available_count + template_items[item].available %}
                {% endfor %}
                {{ available_count }}
            </div>
            <div class="stat-label">Available Items</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon revenue">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-number">$2,450</div>
            <div class="stat-label">Monthly Revenue</div>
        </div>
    </div>

    <div class="manager-content">
        <div class="items-section">
            <div class="section-header">
                <h2>
                    <i class="fas fa-list"></i>
                    Inventory Management
                </h2>
                <div class="search-filter">
                    <input type="text" class="search-input" placeholder="Search items..." id="searchInput">
                    <select class="filter-select" id="stockFilter">
                        <option value="all">All Stock Levels</option>
                        <option value="high">High Stock</option>
                        <option value="medium">Medium Stock</option>
                        <option value="low">Low Stock</option>
                    </select>
                </div>
            </div>

            <table class="items-table" id="itemsTable">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Description</th>
                        <th>Total Stock</th>
                        <th>Available</th>
                        <th>Rented</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in template_items %}
                    <tr>
                        <td class="item-name">{{ template_items[item].item | title }}</td>
                        <td>{{ template_items[item].description | truncate(50) }}</td>
                        <td>{{ template_items[item].stock_size }}</td>
                        <td>{{ template_items[item].available }}</td>
                        <td>{{ template_items[item].stock_size - template_items[item].available }}</td>
                        <td>
                            {% set available_ratio = template_items[item].available / template_items[item].stock_size %}
                            {% if available_ratio > 0.6 %}
                                <span class="stock-badge stock-high">High Stock</span>
                            {% elif available_ratio > 0.3 %}
                                <span class="stock-badge stock-medium">Medium Stock</span>
                            {% else %}
                                <span class="stock-badge stock-low">Low Stock</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="item-actions">
                                <button class="action-btn edit-btn" onclick="editItem('{{ item }}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('{{ item }}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div>
            <div class="add-item-section">
                <div class="section-header">
                    <h2>
                        <i class="fas fa-plus-circle"></i>
                        Add New Item
                    </h2>
                </div>

                <form class="add-item-form" action="/manager" method="POST">
                    {{ template_add_item.hidden_tag() }}

                    <div class="form-group">
                        {{ template_add_item.name.label(class="form-label") }}
                        {{ template_add_item.name(class="form-input", placeholder="Enter item name") }}
                    </div>

                    <div class="form-group">
                        {{ template_add_item.description.label(class="form-label") }}
                        {{ template_add_item.description(class="form-input form-textarea", placeholder="Describe the item...") }}
                    </div>

                    <div class="form-group">
                        {{ template_add_item.stock.label(class="form-label") }}
                        {{ template_add_item.stock(class="form-input", placeholder="Enter stock quantity") }}
                    </div>

                    {{ template_add_item.submit(class="submit-btn") }}
                    <i class="fas fa-plus"></i>
                </form>
            </div>

            <div class="quick-actions">
                <h3>
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </h3>

                <button class="quick-action-btn" onclick="exportData()">
                    <i class="fas fa-download"></i>
                    Export Inventory Data
                </button>

                <button class="quick-action-btn" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i>
                    Generate Monthly Report
                </button>

                <button class="quick-action-btn" onclick="bulkUpdate()">
                    <i class="fas fa-edit"></i>
                    Bulk Update Items
                </button>

                <button class="quick-action-btn" onclick="viewAnalytics()">
                    <i class="fas fa-analytics"></i>
                    View Analytics
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const table = document.getElementById('itemsTable');
    const rows = table.getElementsByTagName('tr');

    for (let i = 1; i < rows.length; i++) {
        const itemName = rows[i].getElementsByTagName('td')[0].textContent.toLowerCase();
        const description = rows[i].getElementsByTagName('td')[1].textContent.toLowerCase();

        if (itemName.includes(searchTerm) || description.includes(searchTerm)) {
            rows[i].style.display = '';
        } else {
            rows[i].style.display = 'none';
        }
    }
});

// Stock filter functionality
document.getElementById('stockFilter').addEventListener('change', function() {
    const filterValue = this.value;
    const table = document.getElementById('itemsTable');
    const rows = table.getElementsByTagName('tr');

    for (let i = 1; i < rows.length; i++) {
        const stockBadge = rows[i].querySelector('.stock-badge');
        const stockLevel = stockBadge.textContent.toLowerCase();

        if (filterValue === 'all' || stockLevel.includes(filterValue)) {
            rows[i].style.display = '';
        } else {
            rows[i].style.display = 'none';
        }
    }
});

// Action functions
function editItem(itemId) {
    alert('Edit functionality for item: ' + itemId + '\n(This would open an edit modal in a real application)');
}

function deleteItem(itemId) {
    if (confirm('Are you sure you want to delete this item?')) {
        alert('Delete functionality for item: ' + itemId + '\n(This would send a delete request in a real application)');
    }
}

function exportData() {
    alert('Exporting inventory data...\n(This would generate and download a CSV/Excel file)');
}

function generateReport() {
    alert('Generating monthly report...\n(This would create a comprehensive business report)');
}

function bulkUpdate() {
    alert('Opening bulk update interface...\n(This would allow updating multiple items at once)');
}

function viewAnalytics() {
    alert('Opening analytics dashboard...\n(This would show detailed business metrics and charts)');
}
</script>
{% endblock %}

